# 데이터 파일 구조 명세서 (Data File Structure Specification)

> **중요:** 이 문서는 실제 Ecount 시스템에서 추출되는 CSV 데이터 파일의 구조를 명세합니다.
>
> **작성일:** 2025-11-01
> **기반:** `docs/samples/` 디렉토리의 실제 CSV 파일 분석

---

## 1. 파일 기본 정보

- **파일 형식:** `.csv` (Comma-Separated Values)
- **파일 개수:** 4개
- **문자 인코딩:** UTF-8 with BOM (한글 포함)
- **구분자(Delimiter):** 쉼표 (`,`)
- **생성 시스템:** Ecount ERP 시스템

---

## 2. 파일 목록

| 파일명 | 설명 | 사용 여부 |
|--------|------|----------|
| `department_kpi.csv` | 학과별 연도별 주요 성과 지표 (KPI) | ✅ 사용 |
| `publication_list.csv` | 논문 게재 현황 | ✅ 사용 |
| `research_project_data.csv` | 연구과제 예산 집행 데이터 | ✅ 사용 |
| `student_roster.csv` | 학생 명부 (학부생, 대학원생) | ✅ 사용 |

---

## 3. 파일별 상세 구조

### 3.1 파일: department_kpi.csv (학과 KPI)

#### 목적
학과별 연도별 주요 성과 지표를 관리합니다.

#### 헤더 정보
- **헤더 행 번호:** 1행
- **데이터 시작 행:** 2행

#### 컬럼 구조

| 컬럼 순서 | 컬럼명 (한글) | 컬럼명 (영문) | 데이터 타입 | 필수 여부 | 비고 |
|----------|--------------|--------------|------------|----------|------|
| 1 | 평가년도 | evaluation_year | Integer (YYYY) | 필수 | 2023~2025 |
| 2 | 단과대학 | college | String(50) | 필수 | 예: 공과대학, 인문대학 |
| 3 | 학과 | department | String(50) | 필수 | 예: 컴퓨터공학과 |
| 4 | 졸업생 취업률 (%) | employment_rate | Decimal(5,2) | 필수 | 0~100 범위 |
| 5 | 전임교원 수 (명) | fulltime_faculty_count | Integer | 필수 | 0 이상 |
| 6 | 초빙교원 수 (명) | visiting_faculty_count | Integer | 필수 | 0 이상 |
| 7 | 연간 기술이전 수입액 (억원) | tech_transfer_revenue | Decimal(10,2) | 필수 | 0 이상, 억 단위 |
| 8 | 국제학술대회 개최 횟수 | intl_conference_count | Integer | 필수 | 0 이상 |

#### 샘플 데이터

```csv
평가년도,단과대학,학과,졸업생 취업률 (%),전임교원 수 (명),초빙교원 수 (명),연간 기술이전 수입액 (억원),국제학술대회 개최 횟수
2023,공과대학,컴퓨터공학과,85.5,15,4,8.5,2
2023,공과대학,전자공학과,88.2,18,3,12.1,3
2024,공과대학,컴퓨터공학과,87.1,16,5,10.2,3
```

#### 특수 규칙
- 동일 연도 + 동일 학과의 데이터는 중복 불가 (Primary Key: 평가년도 + 학과)
- 취업률은 0~100 사이의 값만 허용
- 기술이전 수입액은 억원 단위로 소수점 2자리까지

---

### 3.2 파일: publication_list.csv (논문 목록)

#### 목적
학과별 논문 게재 현황을 관리합니다.

#### 헤더 정보
- **헤더 행 번호:** 1행
- **데이터 시작 행:** 2행

#### 컬럼 구조

| 컬럼 순서 | 컬럼명 (한글) | 컬럼명 (영문) | 데이터 타입 | 필수 여부 | 비고 |
|----------|--------------|--------------|------------|----------|------|
| 1 | 논문ID | publication_id | String(20) | 필수 | 고유 식별자 (예: PUB-23-001) |
| 2 | 게재일 | publication_date | Date (YYYY-MM-DD) | 필수 | - |
| 3 | 단과대학 | college | String(50) | 필수 | - |
| 4 | 학과 | department | String(50) | 필수 | - |
| 5 | 논문제목 | title | String(500) | 필수 | 한글 또는 영문 |
| 6 | 주저자 | first_author | String(100) | 필수 | - |
| 7 | 참여저자 | co_authors | String(500) | 선택 | 세미콜론(;)으로 구분 |
| 8 | 학술지명 | journal_name | String(200) | 필수 | - |
| 9 | 저널등급 | journal_grade | Enum | 필수 | 'SCIE', 'KCI', '일반' 등 |
| 10 | Impact Factor | impact_factor | Decimal(5,2) | 선택 | SCIE 논문만 해당, 빈 값 가능 |
| 11 | 과제연계여부 | project_linked | Enum | 필수 | 'Y' 또는 'N' |

#### 샘플 데이터

```csv
논문ID,게재일,단과대학,학과,논문제목,주저자,참여저자,학술지명,저널등급,Impact Factor,과제연계여부
PUB-23-001,2023-02-18,공과대학,전자공학과,A Study on Low-Power Semiconductor Design,김민준,박지훈;최민서,IEEE Transactions on Circuits and Systems,SCIE,3.9,Y
PUB-23-002,2023-05-22,인문대학,철학과,현대 분석철학의 언어적 전회에 관한 고찰,윤지원,강예원,철학연구,KCI,,N
PUB-24-001,2024-01-30,공과대학,컴퓨터공학과,Deep Learning based Anomaly Detection,이서연,정현우;김유진;한지민,Expert Systems with Applications,SCIE,8.5,Y
```

#### 특수 규칙
- 논문ID는 시스템 전체에서 고유해야 함 (Primary Key)
- 참여저자는 세미콜론(;)으로 구분하며, 주저자는 제외
- Impact Factor는 SCIE 논문의 경우 필수, KCI/일반의 경우 빈 값
- 과제연계여부는 'Y' 또는 'N'만 허용 (대소문자 구분 없음)

---

### 3.3 파일: research_project_data.csv (연구과제 데이터)

#### 목적
연구과제별 예산 집행 내역을 관리합니다.

#### 헤더 정보
- **헤더 행 번호:** 1행
- **데이터 시작 행:** 2행

#### 컬럼 구조

| 컬럼 순서 | 컬럼명 (한글) | 컬럼명 (영문) | 데이터 타입 | 필수 여부 | 비고 |
|----------|--------------|--------------|------------|----------|------|
| 1 | 집행ID | execution_id | String(20) | 필수 | 고유 식별자 (예: T2301001) |
| 2 | 과제번호 | project_number | String(50) | 필수 | 예: NRF-2023-015 |
| 3 | 과제명 | project_name | String(200) | 필수 | - |
| 4 | 연구책임자 | principal_investigator | String(100) | 필수 | 교수명 |
| 5 | 소속학과 | department | String(50) | 필수 | - |
| 6 | 지원기관 | funding_agency | String(100) | 필수 | 예: 한국연구재단 |
| 7 | 총연구비 | total_budget | Integer | 필수 | 단위: 원 |
| 8 | 집행일자 | execution_date | Date (YYYY-MM-DD) | 필수 | - |
| 9 | 집행항목 | expense_item | String(100) | 필수 | 예: 연구장비 도입 |
| 10 | 집행금액 | expense_amount | Integer | 필수 | 단위: 원, 0 이상 |
| 11 | 상태 | status | Enum | 필수 | '집행완료', '처리중', '반려' 등 |
| 12 | 비고 | notes | String(500) | 선택 | 추가 설명 |

#### 샘플 데이터

```csv
집행ID,과제번호,과제명,연구책임자,소속학과,지원기관,총연구비,집행일자,집행항목,집행금액,상태,비고
T2301001,NRF-2023-015,차세대 AI 반도체 설계,김민준,전자공학과,한국연구재단,500000000,2023-03-15,연구장비 도입,120000000,집행완료,A-1급 스펙트로미터
T2301002,IITP-A-23-101,자율주행 시뮬레이션 고도화,이서연,컴퓨터공학과,정보통신기획평가원,800000000,2023-04-20,외부전문가 활용비,8000000,집행완료,
T2402002,IITP-A-23-101,자율주행 시뮬레이션 고도화,이서연,컴퓨터공학과,정보통신기획평가원,800000000,2024-03-05,고성능 서버 임대,45000000,처리중,견적서 검토 단계
```

#### 특수 규칙
- 집행ID는 시스템 전체에서 고유해야 함 (Primary Key)
- 동일 과제번호에 대해 여러 개의 집행 내역이 존재 가능
- 집행금액의 합계가 총연구비를 초과하면 경고 (과제번호별 집계)
- 상태는 '집행완료', '처리중', '반려' 중 하나

---

### 3.4 파일: student_roster.csv (학생 명부)

#### 목적
학부생 및 대학원생의 기본 정보를 관리합니다.

#### 헤더 정보
- **헤더 행 번호:** 1행
- **데이터 시작 행:** 2행

#### 컬럼 구조

| 컬럼 순서 | 컬럼명 (한글) | 컬럼명 (영문) | 데이터 타입 | 필수 여부 | 비고 |
|----------|--------------|--------------|------------|----------|------|
| 1 | 학번 | student_id | String(10) | 필수 | 고유 식별자 (8자리) |
| 2 | 이름 | name | String(50) | 필수 | - |
| 3 | 단과대학 | college | String(50) | 필수 | - |
| 4 | 학과 | department | String(50) | 필수 | - |
| 5 | 학년 | grade | Integer | 필수 | 0~4 (0은 대학원생) |
| 6 | 과정구분 | program_type | Enum | 필수 | '학사', '석사', '박사' |
| 7 | 학적상태 | academic_status | Enum | 필수 | '재학', '휴학', '졸업' 등 |
| 8 | 성별 | gender | Enum | 필수 | '남', '여' |
| 9 | 입학년도 | admission_year | Integer (YYYY) | 필수 | 4자리 연도 |
| 10 | 지도교수 | advisor | String(50) | 선택 | 대학원생의 경우 필수, 학부생은 선택 |
| 11 | 이메일 | email | String(100) | 필수 | 이메일 형식 검증 |

#### 샘플 데이터

```csv
학번,이름,단과대학,학과,학년,과정구분,학적상태,성별,입학년도,지도교수,이메일
20201101,김유진,공과대학,컴퓨터공학과,4,학사,재학,여,2020,이서연,yjkim@university.ac.kr
20211205,박지훈,공과대학,전자공학과,3,학사,재학,남,2021,김민준,jhpark@university.ac.kr
20192101,정현우,공과대학,컴퓨터공학과,0,석사,재학,남,2024,이서연,hwjung@university.ac.kr
20201215,최민서,공과대학,전자공학과,4,학사,휴학,여,2020,김민준,mschoi@university.ac.kr
```

#### 특수 규칙
- 학번은 시스템 전체에서 고유해야 함 (Primary Key)
- 학년이 0인 경우 과정구분은 '석사' 또는 '박사'여야 함
- 과정구분이 '석사' 또는 '박사'인 경우 지도교수는 필수
- 학적상태는 '재학', '휴학', '졸업', '제적' 중 하나
- 이메일은 유효한 이메일 형식이어야 함 (정규식 검증)

---

## 4. 공통 데이터 규칙

### 4.1 날짜 형식
- **표준 형식:** `YYYY-MM-DD` (예: 2024-01-15)
- **대체 허용 형식:** `YYYY.MM.DD`, `YYYY/MM/DD` (파싱 시 표준 형식으로 변환)

### 4.2 숫자 형식
- **정수:** 쉼표 없이 순수 숫자 (예: 1000000, not 1,000,000)
- **소수:** 소수점 이하 최대 2자리 (예: 85.50)
- **음수:** 기본적으로 허용되지 않음 (예외: 비고 컬럼에 명시된 경우)

### 4.3 문자열 형식
- **인코딩:** UTF-8 with BOM
- **특수문자:** 허용 (단, SQL Injection 방지를 위해 이스케이프 처리)
- **최대 길이:** 각 컬럼 명세 참조
- **구분자:** 여러 값을 하나의 컬럼에 저장할 경우 세미콜론(;) 사용 (예: 참여저자)

### 4.4 빈 값 처리
- **필수 컬럼:** 빈 값 불가 (NULL, 빈 문자열, 공백만 있는 경우 모두 오류)
- **선택 컬럼:** 빈 값 허용 (NULL 또는 빈 문자열로 저장)

### 4.5 Enum 값 처리
- **대소문자:** 구분 없이 허용 (자동 대문자로 변환)
  - 예: 'scie', 'SCIE', 'Scie' → 모두 'SCIE'로 변환
- **공백:** 자동 제거 (trim)

---

## 5. 오류 처리 방침

### 5.1 파일 레벨 오류 (전체 업로드 실패)
- 파일 형식이 `.csv`가 아닌 경우
- 파일 인코딩이 UTF-8이 아니어서 한글이 깨진 경우
- 파일 크기가 100MB를 초과하는 경우
- 필수 파일이 누락된 경우 (4개 파일 모두 필요)

### 5.2 헤더 레벨 오류 (해당 파일 전체 무시)
- 헤더 행의 컬럼명이 명세와 일치하지 않는 경우
- 필수 컬럼이 누락된 경우

### 5.3 행 레벨 오류 (해당 행만 무시, 계속 처리)
- 필수 컬럼에 빈 값이 있는 경우
- 데이터 타입이 일치하지 않는 경우 (예: 숫자 컬럼에 문자열)
- 유효성 검증 규칙 위반 (예: 음수 값, 범위 초과)
- Primary Key 중복

### 5.4 경고 (처리는 진행, 로그 기록)
- 선택 컬럼에 예상치 못한 값이 있는 경우
- 크로스 파일 참조 불일치 (예: 논문의 주저자가 student_roster에 없음)
- 데이터 정합성 문제 (예: 과제 총 집행금액이 총연구비 초과)

---

## 6. 파일 간 관계 (Relationships)

### 6.1 Primary Keys
- `department_kpi.csv`: (평가년도, 학과) 복합키
- `publication_list.csv`: 논문ID
- `research_project_data.csv`: 집행ID
- `student_roster.csv`: 학번

### 6.2 Foreign Key 관계 (논리적)
- `publication_list.college/department` → `department_kpi.college/department`
- `publication_list.first_author` → `student_roster.name` (선택적)
- `research_project_data.department` → `department_kpi.department`
- `research_project_data.principal_investigator` → (교수 테이블, 현재 없음)

### 6.3 데이터 정합성 검증
- 학과명이 모든 파일에서 일관되게 사용되어야 함
- 단과대학명도 일관성 유지 필요

---

## 7. 샘플 파일 위치

실제 CSV 샘플 파일은 다음 경로에 저장되어 있습니다:
- `docs/samples/department_kpi.csv`
- `docs/samples/publication_list.csv`
- `docs/samples/research_project_data.csv`
- `docs/samples/student_roster.csv`

---

## 8. 버전 관리

| 버전 | 작성일 | 작성자 | 변경 내역 |
|------|--------|--------|----------|
| 1.0 | 2025-11-01 | Claude Code | 실제 CSV 파일 기반 초기 명세 작성 |

---

## 9. 참고 사항

- 이 명세서는 `dataflow-analyst` 및 `data-validator` 에이전트의 기준 문서로 사용됩니다.
- 실제 Ecount 시스템의 CSV 구조가 변경될 경우 반드시 이 문서를 업데이트해야 합니다.
- 명세와 실제 파일이 불일치할 경우, 개발 완료 후 전체 데이터 파이프라인 재작업이 필요할 수 있습니다.
- 원래 엑셀(.xlsx) 형식을 가정했으나, 실제로는 CSV 형식으로 제공되므로 파싱 로직이 단순화됩니다.

---

## 10. 대시보드 시각화 매핑

각 CSV 파일이 대시보드의 어떤 시각화 컴포넌트에 사용되는지 정의:

| CSV 파일 | 사용될 시각화 컴포넌트 | 비고 |
|----------|---------------------|------|
| `department_kpi.csv` | • 학과별 취업률 차트<br>• 기술이전 수입 추이<br>• 교원 현황 | 주요 KPI 대시보드 |
| `publication_list.csv` | • 연도별 논문 게재 수<br>• 저널 등급별 분포<br>• 학과별 논문 현황 | 연구 성과 대시보드 |
| `research_project_data.csv` | • 연구비 집행 현황<br>• 지원기관별 분포<br>• 과제별 집행률 | 예산 관리 대시보드 |
| `student_roster.csv` | • 학과별 학생 수<br>• 과정별 학생 분포<br>• 학적상태 통계 | 학생 현황 대시보드 |
