# 사용자 상호작용 명세 (User Interaction Specification)

> 이 문서는 `docs/prd.md`에 정의된 각 사용자 스토리에 대한 상세한 상호작용 흐름을 '입력, 처리, 출력'의 구조로 기술합니다.

> **⚠️ 중요:** 이 템플릿을 사용할 때는 반드시 프로젝트의 실제 데이터 복잡도를 고려해야 합니다. 본 프로젝트는 4개의 CSV 파일(department_kpi.csv, publication_list.csv, research_project_data.csv, student_roster.csv)과 각 파일당 수십 개의 컬럼을 포함하는 복잡한 데이터 구조를 다룹니다. 따라서 각 상호작용 흐름에서 다음을 고려해야 합니다:
> - 4개 파일 유형별로 서로 다른 파싱 및 검증 로직이 필요함
> - 각 파일의 수십 개 컬럼에 대한 개별 검증 규칙이 존재함
> - 크로스 필드 검증(예: 총계 일치, 예산 초과 검증 등)이 필요함
> - 데이터 간의 관계(학과, 연도, 과제번호 등)를 고려한 조회 및 집계 로직이 필요함

---

## US-001: 로그인

### 1. 성공 시나리오 (Happy Path)

-   **상황:** 사용자가 유효한 아이디와 비밀번호를 입력하고 로그인을 시도한다.

-   **### 입력 (Input)**
    -   사용자가 아이디와 비밀번호를 입력함.
    -   사용자가 '로그인' 버튼을 클릭함.

-   **### 처리 (Processing)**
    1.  클라이언트가 입력값의 기본 유효성(빈 값 여부 등)을 검사함.
    2.  클라이언트가 로그인 API (`POST /api/auth/token`)로 요청을 전송함.
    3.  서버가 요청된 아이디/비밀번호의 유효성을 데이터베이스와 대조하여 검증함.
    4.  서버가 유효한 자격 증명일 경우, JWT(Access/Refresh Token)를 생성함.
    5.  서버가 생성된 토큰을 포함하여 성공 응답(200 OK)을 반환함.

-   **### 출력 (Output)**
    1.  클라이언트가 수신한 토큰을 안전한 저장소(예: HttpOnly Cookie)에 저장함.
    2.  사용자를 대시보드 페이지로 리디렉션함.

### 2. 실패/엣지케이스 시나리오

-   **상황 1:** 잘못된 아이디 또는 비밀번호를 입력한다.
    -   **처리:** 서버가 자격 증명 검증에 실패하고, 오류 응답(401 Unauthorized)을 반환함.
    -   **출력:** 로그인 폼 하단에 '인증 정보 불일치' 오류 메시지를 표시함.

-   **상황 2:** 서버 또는 네트워크 오류가 발생한다.
    -   **처리:** 클라이언트가 API 요청에 실패하거나 서버로부터 5xx 오류 응답을 받음.
    -   **출력:** 사용자에게 '일시적인 서버 오류' 알림을 표시함.

---

## US-002: 데이터 업로드

### 1. 성공 시나리오 (Happy Path)

-   **상황:** 로그인한 관리자가 유효한 엑셀 파일을 업로드한다.

-   **### 입력 (Input)**
    -   사용자가 '파일 업로드' 영역을 클릭하거나 파일을 드래그앤드롭함.
    -   파일 탐색기에서 유효한 엑셀(.xlsx) 파일을 선택함.

-   **### 처리 (Processing)**
    1.  클라이언트가 선택된 파일의 확장자를 검사함.
    2.  클라이언트가 파일 업로드 API (`POST /api/data/upload`)로 멀티파트 폼 데이터를 전송함. (업로드 중 로딩 인디케이터 표시)
    3.  서버가 업로드된 파일을 임시 저장하고 데이터 파싱을 시작함.
    4.  `docs/data-validation.md` 규칙에 따라 데이터 유효성을 검증함.
    5.  서버가 유효한 데이터를 데이터베이스에 저장함.
    6.  서버가 처리 결과(성공 건수, 실패 건수 등)를 포함하여 성공 응답(201 Created)을 반환함.

-   **### 출력 (Output)**
    1.  로딩 인디케이터가 사라짐.
    2.  '업로드 성공' 피드백을 사용자에게 표시함.
    3.  대시보드 페이지의 데이터가 최신 상태로 갱신되거나, 갱신을 유도함.

### 2. 실패/엣지케이스 시나리오

-   **상황 1:** 지원하지 않는 파일 형식(예: .csv, .pdf)을 업로드한다.
    -   **처리:** 클라이언트 사이드에서 파일 확장자 검사에 실패함.
    -   **출력:** '지원하지 않는 파일 형식' 오류 메시지를 즉시 표시함.

-   **상황 2:** 파일 내부 데이터의 형식이 올바르지 않다.
    -   **처리:** 서버가 데이터 파싱 또는 유효성 검증 단계에서 실패하고, 오류 응답(400 Bad Request)과 함께 실패 원인을 반환함.
    -   **출력:** '데이터 처리 실패' 피드백과 함께 오류의 원인을 사용자에게 표시함.

---